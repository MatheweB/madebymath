---
import Icons from "./Icons.astro";

interface Props {
  about: string[];
  links: { label: string; href: string; external?: boolean }[];
}

const { about, links } = Astro.props;
---

<div class="about-drawer" id="about-drawer">
  <div class="about-drawer-inner">
    <div class="about-drawer-content">
      {about.map((paragraph) => (
        <p class="about-drawer-text font-sans">{paragraph}</p>
      ))}
    </div>
    <div class="about-drawer-links">
      {links.map((link) => (
        <a
          href={link.href}
          class="about-drawer-link font-sans"
          target={link.external ? "_blank" : undefined}
          rel={link.external ? "noopener noreferrer" : undefined}
        >
          {link.label}
          {link.external && <Icons name="external" size={12} />}
        </a>
      ))}
    </div>
  </div>
</div>

<script>
  const drawer = document.getElementById("about-drawer")!;
  let isOpen = false;

  const nav = document.getElementById("main-nav");

  function openDrawer() {
    isOpen = true;
    drawer.classList.add("open");
    nav?.classList.add("scrolled");
  }

  function closeDrawer() {
    isOpen = false;
    drawer.classList.remove("open");
    if (window.scrollY <= 60) nav?.classList.remove("scrolled");
  }

  function toggleDrawer() {
    if (isOpen) closeDrawer();
    else openDrawer();
  }

  // Nav link triggers
  document.querySelectorAll('[data-about-trigger]').forEach((el) => {
    el.addEventListener('click', (e) => {
      e.preventDefault();
      toggleDrawer();
    });
  });

  // Close on scroll
  window.addEventListener('scroll', () => {
    if (isOpen) closeDrawer();
  }, { passive: true });

  // Close on Escape
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && isOpen) closeDrawer();
  });
</script>
